<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>HEMA - Human Evaluation of Medical AI</title>

        <!-- External CSS Dependencies -->
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        />

        <!-- Modular CSS -->
        <link rel="stylesheet" href="css/theme.css" />
        <link rel="stylesheet" href="css/layout.css" />

    </head>
    <body>
        <!-- Navigation Bar -->
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top shadow-sm navbar-custom">
            <div class="container-fluid px-4">
                <a class="navbar-brand fw-bold d-flex align-items-center navbar-brand-custom" href="#">
                    <div class="d-flex align-items-center justify-content-center me-3 navbar-brand-icon">
                        <i class="fas fa-heartbeat text-white"></i>
                    </div>
                    <span>HEMA</span>
                </a>
                <span class="navbar-text ms-3 navbar-subtitle">
                    Human Evaluation of Medical AI Platform
                </span>
                <div class="ms-auto d-flex gap-2">
                    <button id="refreshBtn" class="btn btn-outline-light btn-sm refresh-btn-custom" style="display: none;" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Start fresh">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button id="reportBtn" class="btn btn-outline-light btn-sm report-btn-custom" style="display: none;">
                        <i class="fas fa-file-medical me-2"></i>Report
                    </button>
                </div>
            </div>
        </nav>

        <!-- Landing Page -->
        <div id="landing-page" class="min-vh-100 d-flex align-items-center landing-page-bg">
            <div class="container">
                <div class="row">
                    <div class="col-12 text-center mb-5">
                        <h1 class="display-3 fw-bold mb-3 landing-title">
                            HEMA Platform
                        </h1>
                        <p class="lead landing-subtitle">
                            Human Evaluation of Medical AI Platform
                        </p>
                    </div>
                </div>

                <div class="row g-4">
                    <div class="col-lg-10 col-xl-8 mx-auto">
                        <div class="row g-4 justify-content-center">
                            <div class="col-md-6 col-lg-5">
                                <div class="card h-100 border-0 shadow-lg hover-lift card-custom">
                                    <div class="card-body text-center d-flex flex-column p-4">
                                        <div class="icon-wrapper mb-3 mx-auto mode-icon icon-bg-segmentation">
                                            <i class="fas fa-layer-group text-white"></i>
                                        </div>
                                        <h4 class="card-title fw-bold card-title-custom">
                                            Segmentation
                                        </h4>
                                        <p class="card-text flex-grow-1 card-text-custom">
                                            Analyze medical image segmentation
                                            with overlay visualization and label
                                            category detection.
                                        </p>
                                        <button class="btn btn-lg w-100 btn-segmentation" data-mode="segmentation">
                                            <i class="fas fa-layer-group me-2"></i>Start Evaluation
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-6 col-lg-5">
                                <div class="card h-100 border-0 shadow-lg hover-lift card-custom">
                                    <div class="card-body text-center d-flex flex-column p-4">
                                        <div class="icon-wrapper mb-3 mx-auto mode-icon icon-bg-text">
                                            <i class="fas fa-file-alt text-white"></i>
                                        </div>
                                        <h4 class="card-title fw-bold card-title-custom">
                                            Text Analysis
                                        </h4>
                                        <p class="card-text flex-grow-1 card-text-custom">
                                            Evaluate AI-generated medical text,
                                            reports, and natural language
                                            processing outputs.
                                        </p>
                                        <button class="btn btn-lg w-100 btn-text" data-mode="text">
                                            <i class="fas fa-file-alt me-2"></i>Start Evaluation
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Segmentation Mode -->
        <div
            id="mode-segmentation"
            style="
                display: none;
                padding-top: 60px;
                padding-bottom: 40px;
                background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            "
        >
            <div class="container">
                <div class="row mb-2">
                    <div class="col-12">
                        <div class="d-flex align-items-center mb-2">
                            <button
                                class="btn shadow-sm back-button"
                                style="background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(71, 85, 105, 0.3); color: #f1f5f9; backdrop-filter: blur(10px);"
                            >
                                <i class="fas fa-arrow-left me-2"></i>Back
                            </button>
                            <h2 class="flex-grow-1 text-center mb-0 fw-bold" style="color: #f1f5f9;">
                                Segmentation Evaluation
                            </h2>
                            <div style="width: 73px"></div>
                        </div>
                    </div>
                </div>

                <div class="row g-4 justify-content-center">
                    <div class="col-lg-10">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="card border-0 shadow-lg h-100" style="background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(20px); border: 1px solid rgba(71, 85, 105, 0.3) !important;">
                                    <div class="card-body p-4">
                                        <div
                                            class="d-flex align-items-center mb-3"
                                        >
                                            <div
                                                class="icon-wrapper me-3"
                                                style="
                                                    width: 48px;
                                                    height: 48px;
                                                    background: linear-gradient(
                                                        135deg,
                                                        #059669 0%,
                                                        #10b981 100%
                                                    );
                                                    border-radius: 12px;
                                                    display: flex;
                                                    align-items: center;
                                                    justify-content: center;
                                                    box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
                                                "
                                            >
                                                <i
                                                    class="fas fa-image text-white"
                                                ></i>
                                            </div>
                                            <div>
                                                <h5 class="mb-0 fw-bold" style="color: #f1f5f9;">
                                                    Medical Image
                                                </h5>
                                                <small style="color: #94a3b8;"
                                                    >Base scan data</small
                                                >
                                            </div>
                                        </div>
                                        <div
                                            class="upload-area p-3 border-2 border-dashed rounded-3"
                                            style="
                                                background: rgba(15, 23, 42, 0.6);
                                                border-color: rgba(71, 85, 105, 0.3) !important;
                                            "
                                        >
                                            <input
                                                type="file"
                                                id="imageFile"
                                                class="form-control mb-2"
                                                accept=".nrrd,.nii,.nii.gz"
                                                style="background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(71, 85, 105, 0.3); color: #f1f5f9;"
                                            />
                                            <small class="form-text" style="color: #64748b;"
                                                >NRRD, NIfTI (.nii/.nii.gz)
                                                formats</small
                                            >
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border-0 shadow-lg h-100" style="background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(20px); border: 1px solid rgba(71, 85, 105, 0.3) !important;">
                                    <div class="card-body p-4">
                                        <div
                                            class="d-flex align-items-center mb-3"
                                        >
                                            <div
                                                class="icon-wrapper me-3"
                                                style="
                                                    width: 48px;
                                                    height: 48px;
                                                    background: linear-gradient(
                                                        135deg,
                                                        #dc2626 0%,
                                                        #ea580c 100%
                                                    );
                                                    border-radius: 12px;
                                                    display: flex;
                                                    align-items: center;
                                                    justify-content: center;
                                                    box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
                                                "
                                            >
                                                <i
                                                    class="fas fa-tags text-white"
                                                ></i>
                                            </div>
                                            <div>
                                                <h5 class="mb-0 fw-bold" style="color: #f1f5f9;">
                                                    Segmentation Labels
                                                </h5>
                                                <small style="color: #94a3b8;"
                                                    >Overlay annotations</small
                                                >
                                            </div>
                                        </div>
                                        <div
                                            class="upload-area p-3 border-2 border-dashed rounded-3"
                                            style="
                                                background: rgba(15, 23, 42, 0.6);
                                                border-color: rgba(71, 85, 105, 0.3) !important;
                                            "
                                        >
                                            <input
                                                type="file"
                                                id="labelFile"
                                                class="form-control mb-2"
                                                accept=".nrrd,.nii,.nii.gz"
                                                style="background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(71, 85, 105, 0.3); color: #f1f5f9;"
                                            />
                                            <small class="form-text" style="color: #64748b;"
                                                >Must match image
                                                dimensions</small
                                            >
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Text Analysis Mode -->
        <div
            id="mode-text"
            style="
                display: none;
                padding-top: 60px;
                padding-bottom: 40px;
                background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            "
        >
            <div class="container">
                <div class="row mb-3">
                    <div class="col-12">
                        <div class="d-flex align-items-center mb-3">
                            <button
                                class="btn shadow-sm back-button"
                                style="background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(71, 85, 105, 0.3); color: #f1f5f9; backdrop-filter: blur(10px);"
                            >
                                <i class="fas fa-arrow-left me-2"></i>Back
                            </button>
                            <h2 class="flex-grow-1 text-center mb-0 fw-bold" style="color: #f1f5f9;">
                                Text Analysis Evaluation
                            </h2>
                            <div style="width: 73px"></div>
                        </div>
                    </div>
                </div>

                <div class="row justify-content-center">
                    <div class="col-lg-10">
                        <div class="card border-0 shadow-lg" style="background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(20px); border: 1px solid rgba(71, 85, 105, 0.3) !important;">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-center mb-4">
                                    <div
                                        class="icon-wrapper me-3"
                                        style="
                                            width: 48px;
                                            height: 48px;
                                            background: linear-gradient(
                                                135deg,
                                                #3b82f6 0%,
                                                #1d4ed8 100%
                                            );
                                            border-radius: 12px;
                                            display: flex;
                                            align-items: center;
                                            justify-content: center;
                                            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
                                        "
                                    >
                                        <i
                                            class="fas fa-file-alt text-white"
                                        ></i>
                                    </div>
                                    <div>
                                        <h5 class="mb-0 fw-bold" style="color: #f1f5f9;">
                                            Medical Text Analysis
                                        </h5>
                                        <small style="color: #94a3b8;"
                                            >Evaluate AI-generated medical
                                            content</small
                                        >
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label
                                        for="textInput"
                                        class="form-label fw-semibold"
                                        style="color: #f1f5f9;"
                                        >Input Text</label
                                    >
                                    <textarea
                                        id="textInput"
                                        class="form-control"
                                        rows="12"
                                        placeholder="Paste AI-generated medical text, reports, or clinical notes here for evaluation..."
                                        style="
                                            font-family: 'Inter', sans-serif;
                                            line-height: 1.6;
                                            background: rgba(15, 23, 42, 0.6);
                                            border: 1px solid rgba(71, 85, 105, 0.3);
                                            color: #f1f5f9;
                                        "
                                    ></textarea>
                                </div>
                                <div class="d-flex gap-2">
                                    <button
                                        class="btn btn-lg px-4"
                                        style="background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); border: none; color: white; font-weight: 600; border-radius: 12px; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);"
                                    >
                                        <i class="fas fa-microscope me-2"></i
                                        >Analyze Text
                                    </button>
                                    <button
                                        class="btn btn-lg px-4"
                                        style="background: rgba(30, 41, 59, 0.8); border: 1px solid rgba(71, 85, 105, 0.3); color: #f1f5f9; border-radius: 12px;"
                                    >
                                        <i class="fas fa-upload me-2"></i>Upload
                                        File
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modern Separator -->
        <div id="viewer-separator" class="container mt-3 mb-3" style="display: none;">
            <div class="row">
                <div class="col-12">
                    <div class="d-flex align-items-center">
                        <div class="flex-grow-1" style="height: 1px; background: linear-gradient(90deg, transparent, rgba(71, 85, 105, 0.3), transparent);"></div>
                        <div class="mx-3">
                            <span class="badge border shadow-sm px-4 py-3" style="font-size: 1rem; background: rgba(30, 41, 59, 0.8); color: #f1f5f9; border-color: rgba(71, 85, 105, 0.3) !important;">
                                <i class="fas fa-chart-line me-2"></i>Visualization
                            </span>
                        </div>
                        <div class="flex-grow-1" style="height: 1px; background: linear-gradient(90deg, transparent, rgba(71, 85, 105, 0.3), transparent);"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Shared Viewer Container -->
        <div id="viewer-container" class="container" style="display: none">
            <div class="row">
                <div class="col-12">
                    <div class="card border-0 shadow-lg" style="background: rgba(30, 41, 59, 0.8); backdrop-filter: blur(20px); border: 1px solid rgba(71, 85, 105, 0.3) !important;">
                        <div class="card-body p-0">
                            <div id="viewer" class="viewer-container">
                                <!-- Segmentation Viewer -->
                                <div
                                    id="canvas-container"
                                    style="display: none; position: relative;"
                                >
                                    <canvas id="imageCanvas"></canvas>
                                    <canvas id="labelCanvas"></canvas>
                                    <canvas id="annotationCanvas"></canvas>
                                    <!-- Viewer Controls Overlay -->
                                    <div id="viewer-controls" style="position: absolute; top: 10px; right: 10px; z-index: 1000; opacity: 0.3; transition: opacity 0.3s ease; display: flex; flex-direction: column; gap: 10px;">
                                        <!-- Zoom Controls -->
                                        <div class="control-panel" style="background: rgba(26, 32, 44, 0.95); border-radius: 8px; padding: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); display: flex; flex-direction: column; gap: 5px; border: 1px solid rgba(255,255,255,0.1);">
                                            <button id="panTool" class="btn btn-outline-light btn-sm" style="padding: 6px 10px; border-color: rgba(255,255,255,0.3); color: #e2e8f0;" title="Pan Tool (Click and Drag)">
                                                <i class="fas fa-hand-paper"></i>
                                            </button>
                                            <div style="height: 1px; background: rgba(255,255,255,0.2); margin: 3px 0;"></div>
                                            <button id="zoomIn" class="btn btn-outline-light btn-sm" style="padding: 6px 10px; border-color: rgba(255,255,255,0.3); color: #e2e8f0;" title="Zoom In">
                                                <i class="fas fa-search-plus"></i>
                                            </button>
                                            <button id="resetView" class="btn btn-outline-light btn-sm" style="padding: 6px 10px; border-color: rgba(255,255,255,0.3); color: #e2e8f0;" title="Fit to View">
                                                <i class="fas fa-expand-arrows-alt"></i>
                                            </button>
                                            <button id="zoomOut" class="btn btn-outline-light btn-sm" style="padding: 6px 10px; border-color: rgba(255,255,255,0.3); color: #e2e8f0;" title="Zoom Out">
                                                <i class="fas fa-search-minus"></i>
                                            </button>
                                            <span class="badge bg-primary rounded-pill px-2 text-center" id="zoomValue" style="min-width: 50px; font-size: 11px; background: #4f46e5 !important;">100%</span>
                                        </div>

                                        <!-- Annotation Tools -->
                                        <div class="control-panel" style="background: rgba(26, 32, 44, 0.95); border-radius: 8px; padding: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); display: flex; flex-direction: column; gap: 5px; border: 1px solid rgba(255,255,255,0.1);">
                                            <button id="drawTool" class="btn btn-outline-light btn-sm" style="padding: 6px 10px; border-color: rgba(255,255,255,0.3); color: #e2e8f0;" title="Draw Annotation">
                                                <i class="fas fa-pen"></i>
                                            </button>
                                            <button id="eraseTool" class="btn btn-outline-light btn-sm" style="padding: 6px 10px; border-color: rgba(255,255,255,0.3); color: #e2e8f0;" title="Erase Annotation">
                                                <i class="fas fa-eraser"></i>
                                            </button>
                                            <button id="commentTool" class="btn btn-outline-light btn-sm" style="padding: 6px 10px; border-color: rgba(255,255,255,0.3); color: #e2e8f0;" title="Add Comment">
                                                <i class="fas fa-comment"></i>
                                            </button>
                                            <button id="clearAnnotations" class="btn btn-outline-light btn-sm" style="padding: 6px 10px; border-color: rgba(255,255,255,0.3); color: #e2e8f0;" title="Clear All">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                            <div style="height: 1px; background: rgba(255,255,255,0.2); margin: 5px 0;"></div>
                                            <input type="color" id="colorPicker" value="#ff0000" title="Drawing Color" style="width: 100%; height: 30px; border: none; border-radius: 4px; cursor: pointer;">
                                            <small style="font-size: 9px; text-align: center; color: #e2e8f0; margin-top: 2px;">Color</small>
                                        </div>

                                    </div>

                                    <!-- Star Rating Panel (Left Side) -->
                                    <div id="star-rating-panel" style="position: absolute; top: 50%; left: 10px; transform: translateY(-50%); z-index: 1000; opacity: 0.7; transition: opacity 0.3s ease; display: none;">
                                        <div class="control-panel" style="background: rgba(26, 32, 44, 0.95); border-radius: 8px; padding: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); display: flex; flex-direction: column; gap: 3px; align-items: center;">
                                            <small style="font-size: 8px; color: #e2e8f0; margin-bottom: 5px; writing-mode: vertical-rl; text-orientation: mixed;">Rate</small>
                                            <div id="starRating" style="display: flex; flex-direction: column-reverse; gap: 3px;">
                                                <!-- 10 stars from bottom to top (1-10) -->
                                                <i class="fas fa-star star" data-rating="1" title="1 Star" style="color: #64748b; cursor: pointer; font-size: 12px; transition: all 0.2s ease;"></i>
                                                <i class="fas fa-star star" data-rating="2" title="2 Stars" style="color: #64748b; cursor: pointer; font-size: 12px; transition: all 0.2s ease;"></i>
                                                <i class="fas fa-star star" data-rating="3" title="3 Stars" style="color: #64748b; cursor: pointer; font-size: 12px; transition: all 0.2s ease;"></i>
                                                <i class="fas fa-star star" data-rating="4" title="4 Stars" style="color: #64748b; cursor: pointer; font-size: 12px; transition: all 0.2s ease;"></i>
                                                <i class="fas fa-star star" data-rating="5" title="5 Stars" style="color: #64748b; cursor: pointer; font-size: 12px; transition: all 0.2s ease;"></i>
                                                <i class="fas fa-star star" data-rating="6" title="6 Stars" style="color: #64748b; cursor: pointer; font-size: 12px; transition: all 0.2s ease;"></i>
                                                <i class="fas fa-star star" data-rating="7" title="7 Stars" style="color: #64748b; cursor: pointer; font-size: 12px; transition: all 0.2s ease;"></i>
                                                <i class="fas fa-star star" data-rating="8" title="8 Stars" style="color: #64748b; cursor: pointer; font-size: 12px; transition: all 0.2s ease;"></i>
                                                <i class="fas fa-star star" data-rating="9" title="9 Stars" style="color: #64748b; cursor: pointer; font-size: 12px; transition: all 0.2s ease;"></i>
                                                <i class="fas fa-star star" data-rating="10" title="10 Stars" style="color: #64748b; cursor: pointer; font-size: 12px; transition: all 0.2s ease;"></i>
                                            </div>
                                            <small id="ratingDisplay" style="font-size: 7px; color: #94a3b8; margin-top: 5px; writing-mode: vertical-rl;">0/10</small>
                                        </div>
                                    </div>

                                    <!-- Comments Panel -->
                                    <div id="comments-panel" style="position: absolute; bottom: 10px; left: 10px; z-index: 1000; background: rgba(26, 32, 44, 0.95); border-radius: 8px; padding: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.3); width: 300px; max-height: 200px; overflow-y: auto; display: none; border: 1px solid rgba(255,255,255,0.1);">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <h6 class="m-0 fw-bold" style="color: #e2e8f0;">Slice Comments</h6>
                                            <button id="closeComments" class="btn-close btn-sm" style="font-size: 10px; filter: invert(1);"></button>
                                        </div>
                                        <div id="comments-list" style="max-height: 100px; overflow-y: auto; margin-bottom: 8px;">
                                            <!-- Comments will be dynamically added here -->
                                        </div>
                                        <div class="input-group">
                                            <input type="text" id="comment-input" class="form-control form-control-sm" placeholder="Add comment..." autocomplete="off" style="pointer-events: auto; z-index: 1;">
                                            <button id="add-comment" class="btn btn-primary btn-sm" type="button">
                                                <i class="fas fa-plus"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div
                                    id="error"
                                    class="alert alert-danger"
                                    style="display: none"
                                ></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Segmentation Controls -->
            <div class="row" id="controls" style="display: none">
                <div class="col-12">
                    <div class="card border-0 shadow" style="background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%); backdrop-filter: blur(20px); border: 1px solid rgba(71, 85, 105, 0.3) !important;">
                        <div class="card-body" style="background: transparent !important; color: #f1f5f9 !important;">
                            <div class="row g-4 align-items-center">
                                <div class="col-md-6">
                                    <div class="control-group">
                                        <label
                                            for="sliceSlider"
                                            class="form-label fw-semibold"
                                            style="color: #f1f5f9;"
                                        >
                                            <i
                                                class="fas fa-layer-group me-2"
                                                style="color: #10b981;"
                                            ></i
                                            >Slice Navigation
                                        </label>
                                        <div
                                            class="d-flex align-items-center gap-3"
                                        >
                                            <input
                                                type="range"
                                                id="sliceSlider"
                                                class="form-range flex-grow-1"
                                                min="0"
                                                max="0"
                                                value="0"
                                                style="accent-color: #10b981;"
                                            />
                                            <span
                                                class="badge rounded-pill px-3"
                                                id="sliceInfo"
                                                style="min-width: 60px; background: #10b981; color: white;"
                                                >1/1</span
                                            >
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="control-group">
                                        <label
                                            for="opacitySlider"
                                            class="form-label fw-semibold"
                                            style="color: #f1f5f9;"
                                        >
                                            <i
                                                class="fas fa-adjust me-2"
                                                style="color: #3b82f6;"
                                            ></i
                                            >Label Opacity
                                        </label>
                                        <div
                                            class="d-flex align-items-center gap-3"
                                        >
                                            <input
                                                type="range"
                                                id="opacitySlider"
                                                class="form-range flex-grow-1"
                                                min="0"
                                                max="100"
                                                value="50"
                                                style="accent-color: #3b82f6;"
                                            />
                                            <span
                                                class="badge rounded-pill px-3"
                                                id="opacityValue"
                                                style="min-width: 60px; background: #3b82f6; color: white;"
                                                >50%</span
                                            >
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Generate Report Section -->
            <div class="row mt-4" id="report-section" style="display: none">
                <div class="col-12">
                    <div class="card border-0 shadow-lg" style="background: linear-gradient(135deg, #1a1a1a 0%, #2d3748 100%);">
                        <div class="card-body text-center p-4">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h5 class="text-white mb-2 fw-bold">
                                        <i class="fas fa-file-medical-alt me-2 text-primary"></i>
                                        Medical Analysis Report
                                    </h5>
                                    <p class="text-light mb-0" style="opacity: 0.8;">
                                        Generate a comprehensive report with all annotations, comments, and medical images for clinical documentation.
                                    </p>
                                </div>
                                <div class="col-md-4">
                                    <button id="generateReportBtn" class="btn btn-primary btn-lg px-4 py-3 fw-bold shadow-lg" style="border-radius: 15px; transition: all 0.3s ease; background: #4f46e5; border-color: #4f46e5;">
                                        <i class="fas fa-file-pdf me-2"></i>
                                        Generate Report
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- External JavaScript Dependencies -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>

        <!-- jsPDF with fallback -->
        <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"
                onerror="this.onerror=null; this.src='https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js'"></script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <!-- Debug script to check jsPDF loading -->
        <script>
        window.addEventListener('load', function() {
            console.log('Checking jsPDF availability...');
            console.log('window.jspdf:', typeof window.jspdf);
            console.log('window.jsPDF:', typeof window.jsPDF);
            console.log('window.jspdf.jsPDF:', window.jspdf ? typeof window.jspdf.jsPDF : 'N/A');

            // Make sure jsPDF is globally accessible
            if (window.jspdf && window.jspdf.jsPDF && !window.jsPDF) {
                window.jsPDF = window.jspdf.jsPDF;
                console.log('Set global jsPDF from window.jspdf.jsPDF');
            }
        });
        </script>

        <!-- Main Application Script -->
        <!-- Main Application -->
        <script src="js/hema-app.js"></script>
    </body>
</html>